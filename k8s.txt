docker compose -f docker-compose.yml -f docker-compose.services.yml up -d --build

PreBuild:
	docker tag onlinebooking-notification-service:latest yogeshsolunke/onlinebooking-notification-service:latest
	docker tag onlinebooking-inventory-service:latest yogeshsolunke/onlinebooking-inventory-service:latest
	docker tag onlinebooking-payment-service:latest yogeshsolunke/onlinebooking-payment-service:latest
	docker tag onlinebooking-order-service:latest yogeshsolunke/onlinebooking-order-service:latest
	
	docker push yogeshsolunke/onlinebooking-notification-service:latest
	docker push yogeshsolunke/onlinebooking-inventory-service:latest
	docker push yogeshsolunke/onlinebooking-payment-service:latest
	docker push yogeshsolunke/onlinebooking-order-service:latest


Build_and_Deploy:

	cd C:\Users\Nikita\Desktop\onlinebooking\kube-manifests
	
	kubectl apply -f namespace.yaml
	kubectl -n oms apply -f mysql-secret.yaml -f mysql-initdb-configmap.yaml -f mysql-statefulset.yaml
	kubectl -n oms apply -f kafka-deployment.yaml 
	kubectl -n oms apply -f kafka-topics-job.yaml
	kubectl -n oms apply -f order-deployment.yaml -f payment-deployment.yaml -f inventory-deployment.yaml -f notification-deployment.yaml
	
	kubectl -n oms get pods -w
	kubectl -n oms get all

for outside access:
PS C:\Users\Nikita> minikube service -n oms order-service --url
http://127.0.0.1:54937
❗  Because you are using a Docker driver on windows, the terminal needs to be open to run it.
PS C:\Users\Nikita> minikube service -n oms notification-service --url
http://127.0.0.1:58588
❗  Because you are using a Docker driver on windows, the terminal needs to be open to run it.
PS C:\Users\Nikita> minikube service -n oms order-service --url
http://127.0.0.1:51664
❗  Because you are using a Docker driver on windows, the terminal needs to be open to run it.

clean up resources :

# 1) Apps
kubectl -n oms delete -f order-deployment.yaml -f payment-deployment.yaml -f inventory-deployment.yaml -f notification-deployment.yaml --ignore-not-found

# 2) Kafka topics job
kubectl -n oms delete -f kafka-topics-job.yaml --ignore-not-found

# 3) Kafka
kubectl -n oms delete -f kafka-deployment.yaml --ignore-not-found

# 4) MySQL (StatefulSet + Service)
kubectl -n oms delete -f mysql-statefulset.yaml --ignore-not-found

# 5) MySQL config/secrets
kubectl -n oms delete -f mysql-initdb-configmap.yaml -f mysql-secret.yaml --ignore-not-found

# 6) Namespace (optional, if you want it gone)
kubectl delete -f namespace.yaml --ignore-not-found

